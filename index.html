<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Multi-AI Script Generator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #logConsole {
      margin-top: 20px;
      height: 200px;
      overflow-y: auto;
      background: #f0f0f0;
      padding: 10px;
      border: 1px solid #ccc;
      white-space: pre-wrap;
      font-family: monospace;
    }
    button { padding: 10px 20px; font-size: 16px; margin-top: 10px; }
    textarea { width: 100%; font-family: monospace; font-size: 16px; margin-top: 10px; }
    pre { background: #f5f5f5; padding: 10px; border-radius: 5px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>Multi-AI Script Generator</h1>
  <button id="generateBtn">Generate Script</button>

  <div id="logConsole"></div>
  <div id="root"></div>

  <!-- React + ReactDOM + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Inline main.jsx + App.jsx -->
  <script type="text/babel">

  // App.jsx
  const { useState, useEffect } = React;
  function App({ logFn }) {
    const [requirement, setRequirement] = useState("");
    const [finalScript, setFinalScript] = useState("");
    const [loading, setLoading] = useState(false);

    useEffect(() => {
      logFn("App.jsx mounted");
    }, []);

    const generateScript = async () => {
      logFn("Generate script called with requirement: " + requirement);
      setLoading(true);
      setFinalScript("");

      try {
        // Simulated API call (replace with real API)
        const data = { ok: true, finalScript: "// Generated script for: " + requirement };
        logFn("API response: " + JSON.stringify(data));

        if (data.ok) {
          setFinalScript(data.finalScript);
          logFn("Final script updated");

          setTimeout(() => {
            logFn("Redirecting to next page...");
            alert("Redirecting..."); // for demo
            // window.location.href = "/next.html"; // uncomment for real redirect
          }, 2000);
        } else {
          logFn("Error generating script: " + (data.error || "Unknown error"));
          alert("Error generating script");
        }
      } catch (e) {
        logFn("Fetch error: " + e);
        alert("Server error");
      } finally {
        setLoading(false);
      }
    };

    const copyToClipboard = () => {
      navigator.clipboard.writeText(finalScript);
      logFn("Script copied to clipboard");
      alert("Script copied!");
    };

    return (
      <div>
        <textarea
          rows={6}
          placeholder="Enter your requirement here..."
          value={requirement}
          onChange={(e) => {
            setRequirement(e.target.value);
            logFn("Requirement changed: " + e.target.value);
          }}
        />
        <button onClick={generateScript} disabled={loading}>
          {loading ? "Generating..." : "Generate Script"}
        </button>

        {finalScript && (
          <div style={{ marginTop: 20 }}>
            <h3>Final Script:</h3>
            <pre>{finalScript}</pre>
            <button onClick={copyToClipboard}>Copy Script</button>
          </div>
        )}
      </div>
    );
  }

  // main.jsx
  window.callMain = function(logFn) {
    logFn("main.jsx picked the call.");
    logFn("Calling App.jsx...");

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App logFn={logFn} />);

    logFn("main.jsx finished calling App.jsx.");
  };
  </script>

  <script>
    // index.html button logic
    const logConsole = document.getElementById("logConsole");

    function addLog(msg) {
      logConsole.textContent += msg + "\n";
      logConsole.scrollTop = logConsole.scrollHeight;
    }

    document.getElementById("generateBtn").addEventListener("click", () => {
      addLog("Calling main.jsx...");
      if (window.callMain) {
        window.callMain(addLog);
      } else {
        addLog("main.jsx function not found!");
      }
    });
  </script>
</body>
</html>