<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Multi-AI Script Generator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #logConsole {
      margin-top: 20px;
      height: 200px;
      overflow-y: auto;
      background: #f0f0f0;
      padding: 10px;
      border: 1px solid #ccc;
      white-space: pre-wrap;
      font-family: monospace;
    }
    button { padding: 10px 20px; font-size: 16px; margin-top: 10px; }
    textarea { width: 100%; font-family: monospace; font-size: 16px; margin-top: 10px; }
    pre { background: #f5f5f5; padding: 10px; border-radius: 5px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>Multi-AI Script Generator</h1>
  <button id="generateBtn">Generate Script</button>

  <div id="logConsole"></div>
  <div id="root"></div>

  <!-- React + ReactDOM + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Inline main.jsx + App.jsx -->
  <script type="text/babel">
    const { useState, useEffect } = React;

    const AI_ENDPOINTS = {
      chatgpt: "https://ai-api-phi-seven.vercel.app/api/chatgpt",
      deepseek: "https://ai-api-phi-seven.vercel.app/api/deepseek",
      gemini: "https://ai-api-phi-seven.vercel.app/api/gemini",
      grok: "https://ai-api-phi-seven.vercel.app/api/grok",
      qwen: "https://ai-api-phi-seven.vercel.app/api/qwen",
      calude: "https://ai-api-phi-seven.vercel.app/api/calude",
      meta: "https://ai-api-phi-seven.vercel.app/api/meta",
    };

    async function callAI(url, message, logFn) {
      logFn?.(`Calling AI endpoint: ${url} with message: "${message}"`);
      const res = await fetch(`${url}?message=${encodeURIComponent(message)}`);
      const data = await res.json();
      logFn?.(`Response from ${url}: ${JSON.stringify(data)}`);
      return { success: data.success, msg: data.msg };
    }

    function App({ logFn }) {
      const [requirement, setRequirement] = useState("");
      const [finalScript, setFinalScript] = useState("");
      const [loading, setLoading] = useState(false);

      useEffect(() => {
        logFn?.("App.jsx mounted");
      }, []);

      const generateScript = async () => {
        logFn?.("Generate script called with requirement: " + requirement);
        setLoading(true);
        setFinalScript("");

        try {
          const aiResponses = await Promise.all(
            Object.values(AI_ENDPOINTS).map((url) => callAI(url, requirement, logFn))
          );

          logFn?.("All AI responses collected");

          const aggregatedInput = aiResponses.map((r, i) => `AI${i + 1}: ${r.msg}`).join("\n");

          const finalRes = await callAI(AI_ENDPOINTS.chatgpt, aggregatedInput, logFn);

          setFinalScript(finalRes.msg);
          logFn?.("Final script updated");

          setTimeout(() => {
            logFn?.("Redirecting to next page...");
            window.location.href = "/next.html"; // change as needed
          }, 2000);
        } catch (err) {
          logFn?.("Error in generateScript: " + err);
          alert("Error generating script");
        } finally {
          setLoading(false);
        }
      };

      const copyToClipboard = () => {
        navigator.clipboard.writeText(finalScript);
        logFn?.("Script copied to clipboard");
      };

      return (
        <div>
          <textarea
            rows={6}
            placeholder="Enter your requirement here..."
            value={requirement}
            onChange={(e) => {
              setRequirement(e.target.value);
              logFn?.("Requirement changed: " + e.target.value);
            }}
          />
          <button onClick={generateScript} disabled={loading || !requirement.trim()}>
            {loading ? "Generating..." : "Generate Script"}
          </button>

          {finalScript && (
            <div style={{ marginTop: 20 }}>
              <h3>Final Script:</h3>
              <pre>{finalScript}</pre>
              <button onClick={copyToClipboard}>Copy Script</button>
            </div>
          )}
        </div>
      );
    }

    window.callMain = function(logFn) {
      logFn?.("main.jsx picked the call.");
      logFn?.("Calling App.jsx...");

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App logFn={logFn} />);

      logFn?.("main.jsx finished calling App.jsx.");
    };
  </script>

  <script>
    const logConsole = document.getElementById("logConsole");

    function addLog(msg) {
      logConsole.textContent += msg + "\n";
      logConsole.scrollTop = logConsole.scrollHeight;
    }

    document.getElementById("generateBtn").addEventListener("click", () => {
      addLog("Calling main.jsx...");
      if (window.callMain) {
        window.callMain(addLog);
      } else {
        addLog("main.jsx function not found!");
      }
    });
  </script>
</body>
</html>